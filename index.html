<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Satellite Telemetry Dashboard</title>

  <!-- Google Fonts & Plotly.js -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div class="container">
    <h2>ðŸš€ Satellite Telemetry Dashboard</h2>

    <div class="card">
      <label for="signal-select">Select telemetry signals:</label>
      <select id="signal-select" multiple></select>
    </div>

    <div class="card">
      <div id="plot"></div>
    </div>

    <div class="footer">
      Data loaded from <code>data/sat_log.csv</code>
    </div>
  </div>

  <!-- Plotly & JS Logic -->
  <script>
    fetch('data/sat_log.csv')
      .then(res => res.text())
      .then(text => {
        const lines = text.trim().split('\n');
        const signals = lines[0].split(',').slice(1);
        const rows = lines.slice(1).map(r => r.split(','));
        const timestamps = rows.map(r => r[0]);
        const data = signals.map((s,i) => rows.map(r => +r[i+1]));

        const sel = document.getElementById('signal-select');
        signals.forEach((s,i) => {
          const o = document.createElement('option');
          o.value = i; o.text = s;
          sel.add(o);
        });

        const layout = {
          xaxis: {
            rangeslider: {},
            rangeselector: {
              buttons: [
                {step: 'hour', stepmode: 'backward', count: 1, label: '1h'},
                {step: 'day',  stepmode: 'backward', count: 1, label: '1d'},
                {step: 'all'}
              ]
            }
          },
          yaxis: { title: 'Value' },
          legend: { orientation: 'h' }
        };

        function plotMulti(idxs) {
          const traces = idxs.map(i => ({
            x: timestamps,
            y: data[i],
            type: 'scatter',
            mode: 'lines',
            name: signals[i]
          }));
          Plotly.newPlot('plot', traces, layout, {responsive: true});
        }

        sel.addEventListener('change', e => {
          const idxs = [...e.target.selectedOptions].map(o => +o.value);
          plotMulti(idxs);
        });

        // Initial plot
        sel.selectedIndex = 0;
        plotMulti([0]);
      })
      .catch(err => console.error('Failed to load CSV:', err));
  </script>
</body>
</html>
