<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Satellite Telemetry Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/style.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

  <div class="container">
    <h2>Satellite Telemetry Dashboard</h2>
    <select id="signal-select" multiple></select>
    <div id="plot"></div>
    <div class="footer">Data is loaded from <code>data/sat_log.csv</code></div>
  </div>

  <script>
    fetch('data/sat_log.csv')
      .then(res => res.text())
      .then(text => {
        const lines = text.trim().split('\n');
        const signals = lines[0].split(',').slice(1);
        const rows = lines.slice(1).map(r => r.split(','));
        const timestamps = rows.map(r => r[0]);
        const data = signals.map((s,i) => rows.map(r => +r[i+1]));

        const sel = document.getElementById('signal-select');
        signals.forEach((s,i) => {
          const o = document.createElement('option');
          o.value = i; o.text = s;
          sel.add(o);
        });
        sel.multiple = true;

        const layout = {
          xaxis: {
            rangeslider: {},
            rangeselector: {
              buttons: [
                { step: 'hour', stepmode: 'backward', count: 1, label: '1h' },
                { step: 'day',  stepmode: 'backward', count: 1, label: '1d' },
                { step: 'all' }
              ]
            }
          },
          yaxis: { title: 'Value' }
        };

        function plotMulti(idxs) {
          const traces = idxs.map(i => ({
            x: timestamps,
            y: data[i],
            type: 'scatter',
            mode: 'lines',
            name: signals[i]
          }));
          Plotly.newPlot('plot', traces, layout, {responsive: true});
        }

        sel.addEventListener('change', e => {
          const idxs = [...e.target.selectedOptions].map(o => +o.value);
          if (idxs.length) plotMulti(idxs);
        });
        sel.selectedIndex = 0;
        plotMulti([0]);
      })
      .catch(err => console.error('Error loading CSV', err));
  </script>
  
</body>
</html>
